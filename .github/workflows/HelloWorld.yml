on:
  push:
    branches:
      - main
  workflow_dispatch:

jobs:
  build:
    runs-on: [self-hosted , pwsh-script]

    steps:
    - uses: actions/checkout@v2
    - uses: pdm-project/setup-pdm@main
      name: Setup PDM
      with:
        python-version: 3.10  # Version range or exact version of a Python version to use, the same as actions/setup-python
        architecture: x64    # The target architecture (x86, x64) of the Python interpreter. the same as actions/setup-python
        version: 1.4.0       # The version of PDM to install. Leave it as empty to use the latest version from PyPI
        prerelease: true     # Allow prerelease versions to be installed
        enable-pep582: true  # Enable PEP 582 package loading globally
    - name: Install dependencies
      run: pdm install       # Then you can use pdm in the following steps.

    # - name: Create and start virtual environment
    #   run: |
    #       python -m venv venv
    #       source venv/bin/activate
    # - name: Set up dependency caching for faster installs
    #   uses: actions/cache@v3
    #   with:
    #     path: ~/.cache/pip
    #     key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
    #     restore-keys: |
    #       ${{ runner.os }}-pip-
    - name: Install dependencies
      run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt
    - name: Run script file
      run: |
          icacls ".\scripts\test.ps1" /grant Users:F
          .\scripts\test.ps1
      shell: powershell
